<HTML
><HEAD
><TITLE
>Features</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.41"><LINK
REL="HOME"
TITLE="PHP3 Manual"
HREF="manual.html"><LINK
REL="UP"
TITLE="Language Reference"
HREF="langref.html"><LINK
REL="PREVIOUS"
TITLE="Security"
HREF="config-security.html"><LINK
REL="NEXT"
TITLE="GIF creation with PHP"
HREF="feature-images.html"></HEAD
><BODY
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PHP3 Manual</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="config-security.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="feature-images.html"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="CHAPTER"
><H1
><A
NAME="FEATURES"
>Chapter 4. Features</A
></H1
><DIV
CLASS="TOC"
><DL
><DT
><B
>Table of Contents</B
></DT
><DT
><A
HREF="features.html#FEATURE-HTTPAUTH"
>HTTP authentication with PHP</A
></DT
><DT
><A
HREF="feature-images.html"
>GIF creation with PHP</A
></DT
><DT
><A
HREF="feature-fileupload.html"
>File upload support</A
></DT
><DT
><A
HREF="feature-putsupport.html"
>PUT Method Support</A
></DT
><DT
><A
HREF="feature-cookies.html"
>HTTP cookie support</A
></DT
><DT
><A
HREF="feature-regexps.html"
>Regular expressions</A
></DT
><DT
><A
HREF="feature-error-handling.html"
>Error handling</A
></DT
><DT
><A
HREF="feature-connection-handling.html"
>Connection  Handling</A
></DT
></DL
></DIV
><P
></P
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="FEATURE-HTTPAUTH"
>HTTP authentication with PHP</A
></H1
><P
>    The HTTP Authentication hooks in PHP are only available when it is
    running as an Apache module and is hence not available in the CGI version.
    In an Apache module PHP script, it is possible to use the 
    <A
HREF="function.header.html"
><B
CLASS="FUNCTION"
>Header()</B
></A
> function to send an "Authentication Required" 
    message to the client browser causing it to pop up a Username/Password 
    input window.  Once the user has filled in a username and a password, 
    the URL containing the PHP script will be called again with the variables,
    $PHP_AUTH_USER, $PHP_AUTH_PW and $PHP_AUTH_TYPE set to the user
    name, password and authentication type respectively.  Only "Basic"
    authentication is supported at this point. See the <A
HREF="function.header.html"
><B
CLASS="FUNCTION"
>Header()</B
></A
>
    function for more information.
   
   </P
><P
>    An example script fragment which would force client authentication
    on a page would be the following:

    <TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
CLASS="EXAMPLE"
><TR
><TD
><DIV
CLASS="EXAMPLE"
><P
><B
>Example 4-1. HTTP Authentication example</B
></P
><PRE
CLASS="PROGRAMLISTING"
>&lt;?php
  if(!isset($PHP_AUTH_USER)) {
    Header(&quot;WWW-Authenticate: Basic realm=\&quot;My Realm\&quot;&quot;);
    Header(&quot;HTTP/1.0 401 Unauthorized&quot;);
    echo &quot;Text to send if user hits Cancel button\n&quot;;
    exit;
  } else {
    echo &quot;Hello $PHP_AUTH_USER.&lt;P&gt;&quot;;
    echo &quot;You entered $PHP_AUTH_PW as your password.&lt;P&gt;&quot;;
  }
?&#62;
     </PRE
></DIV
></TD
></TR
></TABLE
>

   </P
><P
>    Instead of simply printing out the $PHP_AUTH_USER and
    $PHP_AUTH_PW, you would probably want to check the username and
    password for validity.  Perhaps by sending a query to a database,
    or by looking up the user in a dbm file.
   </P
><P
>    Watch out for buggy Internet Explorer browsers out there.  They
    seem very picky about the order of the headers.  Sending the
    <I
CLASS="EMPHASIS"
>WWW-Authenticate</I
> header before the
    <SPAN
CLASS="ERRORCODE"
>HTTP/1.0 401</SPAN
> header seems to do the trick
    for now.
   </P
><P
>    In order to prevent someone from writing a script which reveals
    the password for a page that was authenticated through a
    traditional external mechanism, the PHP_AUTH variables will not be
    set if external authentication is enabled for that particular
    page. In this case, the $REMOTE_USER variable can be used to
    identify the externally-authenticated user.
   </P
><P
>    Note, however, that the above does not prevent someone who
    controls a non-authenticated URL from stealing passwords from
    authenticated URLs on the same server.
   </P
><P
>    Both Netscape and Internet Explorer will clear the local browser
    window's authentication cache for the realm upon receiving a
    server response of 401. This can effectively "log out" a user,
    forcing them to re-enter their username and password. Some people
    use this to "time out" logins, or provide a "log-out" button.
   </P
><P
>    </P
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
CLASS="EXAMPLE"
><TR
><TD
><DIV
CLASS="EXAMPLE"
><P
><B
>Example 4-2. HTTP Authentication example forcing a new name/password</B
></P
><PRE
CLASS="PROGRAMLISTING"
>&lt;?php
  function  authenticate()  {
    Header( &quot;WWW-authenticate:  basic  realm='Test  Authentication  System'&quot;);
    Header( &quot;HTTP/1.0  401  Unauthorized&quot;);
    echo  &quot;You  must  enter  a  valid  login  ID  and  password  to  access  this  resource\n&quot;;
    exit;
  }

  if(!isset($PHP_AUTH_USER)  ||  ($SeenBefore ==  1  &#38;&#38;  !strcmp($OldAuth,  $PHP_AUTH_USER))  )  {
    authenticate();
  }  
  else  {
    echo  &quot;Welcome:  $PHP_AUTH_USER&lt;BR&gt;&quot;;
    echo  &quot;Old:  $OldAuth&quot;;
    echo  &quot;&lt;FORM  ACTION=\&quot;$PHP_SELF\&quot;  METHOD=POST&gt;\n&quot;;
    echo  &quot;&lt;INPUT  TYPE=HIDDEN  NAME=\&quot;SeenBefore\&quot;  VALUE=\&quot;1\&quot;&gt;\n&quot;;
    echo  &quot;&lt;INPUT  TYPE=HIDDEN  NAME=\&quot;OldAuth\&quot;  VALUE=\&quot;$PHP_AUTH_USER\&quot;&gt;\n&quot;;
    echo  &quot;&lt;INPUT  TYPE=Submit  VALUE=\&quot;Re  Authenticate\&quot;&gt;\n&quot;;
    echo  &quot;&lt;/FORM&gt;\n&quot;;

}
?&#62;
    </PRE
></DIV
></TD
></TR
></TABLE
><P
>    This behavior is not required by the HTTP Basic authentication
    standard, so you should never depend on this. Testing with Lynx
    has shown that Lynx does not clear the authentication credentials
    with a 401 server response, so pressing back and then forward
    again will open the resource (as long as the credential
    requirements haven't changed).
   </P
><P
>    Also note that this does not work using Microsoft's IIS server and
    the CGI version of PHP due to a limitation of IIS.


  </P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="config-security.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="manual.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="feature-images.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Security</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="langref.html"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>GIF creation with PHP</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>